<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MacroLegend</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.cdnfonts.com/css/ringbearer" rel="stylesheet">
  <style>
    :root {
      --light-bg: #f6f6fa;
      --light-card: #fff;
      --light-text: #1a1a1a;
      --light-accent: #2b78e4;
      --light-bar: #d6eaff;
      --light-shadow: 0 4px 32px #0002;
      --gold: #fbe62c;
      --ring-shadow: 0 0 18px 6px #edb94144;
      --ring-bar: #f8c944;
      --ring-green: #7dc271;
      --ring-blue: #5ba4fa;
      --ring-orange: #f5a94d;
      --ring-bg: #2a2009;
      --ring-card: #382a00;
      --ring-txt: #e2e6d8;
      --ring-inscription: #bd8c19;
      --progress-radius: 13px;
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--light-bg);
      color: var(--light-text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-sizing: border-box;
      transition: background 0.3s, color 0.3s;
    }
    .container {
      background: var(--light-card);
      box-shadow: var(--light-shadow);
      border-radius: 22px;
      max-width: 510px;
      width: calc(100vw - 26px);
      margin: 4vw 0 12vw 0;
      padding: 2.1em 2.2em 3em 2.2em;
      transition: background 0.3s;
      position: relative;
      min-width: 0;
      box-sizing: border-box;
      z-index: 10;
    }
    h1 {
      font-family: 'Ringbearer', 'Inter', serif;
      font-size: 2.35rem;
      letter-spacing: 2px;
      margin: 0 0 0.7em 0;
      text-align: center;
      color: var(--light-accent);
      transition: color 0.3s, text-shadow 0.3s;
      user-select: none;
      padding-top: 0.6em;
    }
    .ringmode h1 {
      color: var(--gold);
      text-shadow: 0 2px 14px #edb94199;
      letter-spacing: 2px;
    }
    .theme-toggle {
      display: flex; gap: 8px;
      position: absolute;
      top: 18px; right: 24px;
    }
    .theme-btn {
      background: var(--light-bar);
      border: none;
      border-radius: 16px;
      padding: 4px 14px;
      font-size: 1.03rem;
      color: var(--light-accent);
      font-weight: 700;
      cursor: pointer;
      margin-left: 4px;
      box-shadow: 0 2px 7px #0001;
      transition: background 0.2s, color 0.2s;
    }
    .theme-btn.active, .theme-btn:focus {
      background: var(--gold);
      color: #3b2e08;
      outline: none;
    }
    .tab-row {
      display: flex; justify-content: center;
      gap: 16px; margin: 0 0 2em 0;
      margin-top: 1.7em;
    }
    .tab-btn {
      background: #eceefe; color: #4275ba;
      border: none; border-radius: 9px 9px 0 0;
      padding: 12px 35px; font-weight: 700; font-size: 1.12em;
      cursor: pointer; box-shadow: 0 2px 7px #0001;
      transition: background 0.17s, color 0.17s;
    }
    .tab-btn.active, .tab-btn:focus {
      background: var(--light-accent);
      color: #fff;
    }
    .ringmode .tab-btn {
      background: #332808;
      color: #e2e6d8;
    }
    .ringmode .tab-btn.active { background: #fbe62c; color: #382a00; }
    .goal-line {
      font-size: 1.13em; color: #4c4c4c; background: #f6f6fa;
      border-radius: 9px; margin: 0 auto 1.6em auto; text-align: center;
      padding: 0.45em 1.2em; font-weight: 500; letter-spacing: 0.5px;
      display: flex; justify-content: center; gap: 2.2em; flex-wrap: wrap;
      max-width: 99vw; white-space: nowrap;
    }
    .goal-line span { font-weight: 700; letter-spacing: 0.2px; padding: 0 2px; }
    .goal-macro-p { color: #49a858; }
    .goal-macro-c { color: #3677c6; }
    .goal-macro-f { color: #e8a200; }
    .goal-macro-cal { color: #d4b117; }
    .macro-bars {
      margin-bottom: 1.8em; margin-top: 1.4em;
      display: flex; flex-direction: column; gap: 1.2em;
    }
    .macro-bar-outer {
      background: var(--light-bar); border-radius: var(--progress-radius);
      overflow: hidden; position: relative; height: 38px; margin: 0 0.1em;
    }
    .macro-bar-inner { height: 100%; display: flex; align-items: center; font-weight: 600; font-size: 1.09em; justify-content: flex-start; padding-left: 17px; border-radius: var(--progress-radius); transition: width 0.45s cubic-bezier(.35,1.65,.6,1.1); color: #fff; letter-spacing: 0.5px; text-shadow: 0 1px 8px #0004; white-space: nowrap; position: relative;}
    .bar-cal { background: linear-gradient(90deg,#fbe62c,#f5c80f); color: #735900; }
    .bar-p { background: linear-gradient(90deg,#51c16e,#379956); }
    .bar-c { background: linear-gradient(90deg,#61aaff,#396ebb); }
    .bar-f { background: linear-gradient(90deg,#f5a94d,#d1850b); }
    .macro-bar-label { position: absolute; left: 50%; top: 50%; transform: translate(-50%,-50%); color: #fff; font-size: 1.09em; font-weight: 700; text-shadow: 0 1px 4px #0006; width: 100%; text-align: center; pointer-events: none; letter-spacing: 0.5px; z-index: 2;}
    #macroChart { width: 100% !important; max-width: 98vw; height: 200px; background: #e8f2ff; border-radius: 11px; margin: 2.2em 0 2.5em 0; box-shadow: 0 2px 8px #0002;}
    .meal-log-table { width: 100%; margin-bottom: 1.4em; border-collapse: collapse; font-size: 1.14em; background: #fff; border-radius: 14px; box-shadow: 0 1px 8px #0001; overflow-x: auto;}
    .meal-log-table th, .meal-log-table td { padding: 12px 10px; border: none; text-align: center; white-space: nowrap; font-size: 1.01em;}
    .meal-log-table th { background: #f2f6fc; color: #5179c2; font-weight: 700;}
    .meal-log-table tbody tr:nth-child(even) { background: #f7faff;}
    .export-row { display: flex; gap: 1.5em; justify-content: flex-end; margin-bottom: 1em;}
    .export-btn { background: #e9eef6; color: #2b78e4; font-size: 1.09em; padding: 7px 26px; border-radius: 7px; border: none; font-weight: 700; cursor: pointer; margin: 0; box-shadow: 0 1px 3px #0001; transition: background 0.13s, color 0.13s;}
    .export-btn:hover, .export-btn:focus { background: #d6eaff; color: #0c51a4;}
    .streak-ring-wrap { margin: 0 auto; margin-top: 2.2em; width: 170px; height: 170px; display: flex; align-items: center; justify-content: center; position: relative; transition: filter 0.3s;}
    .streak-ring-svg { width: 100%; height: 100%; display: block; filter: drop-shadow(var(--ring-shadow)); }
    .streak-center-label { position: absolute; left: 50%; top: 51%; transform: translate(-50%,-50%); width: 110px; text-align: center; color: var(--ring-txt); font-family: 'Ringbearer', 'Inter', serif; font-size: 1.18em; line-height: 1.14; font-weight: 700; text-shadow: 0 0 11px #edb941c5, 0 1px 2px #000c; pointer-events: none;}
    .streak-week-phrase { position: absolute; left: 50%; top: 104%; transform: translate(-50%,0); font-family: 'Ringbearer','Inter',serif; color: #fbe62c; font-size: 1.13em; text-align: center; width: 180px; filter: brightness(1.05) blur(0.1px); text-shadow: 0 0 10px #edb94188, 0 2px 8px #000a; pointer-events: none;}
    .streak-bar-wrap { width: 100%; max-width: 390px; margin: 2.5em auto 0.7em auto; background: #d6eaff; border-radius: 16px; box-shadow: 0 1px 4px #0001; padding: 0.9em 1.5em; font-size: 1.13em; color: #2b78e4; font-weight: 700; letter-spacing: 1px; display: flex; align-items: center; gap: 16px; justify-content: center;}
    .streak-bar-value { background: #2b78e4; color: #fff; border-radius: 12px; padding: 2.5px 16px; margin: 0 8px; font-size: 1em; font-weight: 700; box-shadow: 0 2px 6px #2b78e411;}
    .macro-input-row, .add-meal-row { display: flex; gap: 1.4em; flex-wrap: wrap; justify-content: center; margin-bottom: 1.4em;}
    .macro-input { flex: 1 1 41%; min-width: 110px; max-width: 170px; font-size: 1.17em; padding: 13px 10px; margin: 0 0 12px 0; border-radius: 8px; border: 1.2px solid #b6c6e1; background: #f6faff; color: #1a2a2a; box-shadow: 0 2px 5px #b6d4fa11; outline: none; transition: border 0.15s;}
    .macro-input:focus { border: 1.2px solid #2b78e4; }
    .meal-name-input, .meal-amt-input { font-size: 1.14em; border-radius: 7px; padding: 12px 11px; border: 1.2px solid #c0c9db; outline: none; background: #f7fafc; color: #252525; box-shadow: 0 1px 2px #c7e3fa11; transition: border 0.16s;}
    .meal-name-input:focus, .meal-amt-input:focus { border: 1.2px solid #49a858; }
    .add-meal-btn, .scan-btn {
      background: #2b78e4; color: #fff; border: none; border-radius: 8px; font-weight: 700;
      padding: 12px 25px; font-size: 1.09em; cursor: pointer; margin-left: 4px; box-shadow: 0 2px 6px #0002;
      transition: background 0.16s, color 0.16s;
      display: flex; align-items: center; gap: 0.5em;
    }
    .add-meal-btn:hover, .add-meal-btn:focus,
    .scan-btn:hover, .scan-btn:focus { background: #49a858; color: #fff;}
    .scan-btn { background: #fbe62c; color: #382a00; font-weight: 800; padding: 12px 17px;}
    .scan-btn svg {width:1.4em;height:1.4em;vertical-align:middle;}
    .autocomplete-list {
      position: absolute; top: 110%; left: 0; right: 0; z-index: 40;
      background: #f7fafc; border-radius: 0 0 11px 11px; box-shadow: 0 6px 22px #0002;
      max-height: 220px; overflow-y: auto; font-size: 1.11em;
      color: #262626;
      border: 1.5px solid #e9e3ce;
    }
    .autocomplete-list div {
      padding: 12px 18px; cursor: pointer; transition: background 0.15s;
      border-bottom: 1px solid #eee;
    }
    .autocomplete-list div.selected, .autocomplete-list div:hover {
      background: #eee9ca;
      color: #23200a;
    }
    .autocomplete-no { color: #bbb; font-size: 1.05em; text-align: center; padding: 15px 0;}
    .quote-row {
      font-family: 'Ringbearer', 'Inter', serif;
      color: #7d8682;
      font-size: 1.19em;
      text-align: center;
      margin-top: 2.8em;
      margin-bottom: 0.4em;
      padding: 16px 8px 12px 8px;
      width: 100%;
      line-height: 1.4;
      border-top: 2px solid #e9e3ce;
      border-bottom: 2px solid #e9e3ce;
      box-sizing: border-box;
      background: linear-gradient(90deg,#ece6ca 0%, #fcf6de 100%);
    }
    /* Barcode video overlay */
    #barcodeVideo {
      position: fixed; left:0; top:0; width: 100vw; height: 100vh; object-fit:cover; z-index: 9998; background:#000f;
      display: none;
    }
    #barcodeOverlay {
      position:fixed;left:0;top:0;width:100vw;height:100vh;z-index:9999;pointer-events:none;display:none;
    }
    #barcodeOverlay::after {
      content:''; display:block; position:absolute;left:0;top:0;width:100vw;height:100vh;
      background:radial-gradient(ellipse at center,#fff0 60%,#000c 100%);
      pointer-events:none;
    }
    #barcodeCancelBtn {
      position:fixed;top:15px;right:24px;z-index:10000;background:#fbe62c;color:#382a00;border:none;border-radius:12px;padding:12px 22px;font-size:1.15em;font-weight:800;box-shadow:0 2px 12px #0009;cursor:pointer;
      display:none;
    }
    /* ========== RING MODE TEXTURE ========== */
    .ringmode, .ringmode body {
      background: #221b09 !important;
      color: var(--ring-txt) !important;
      transition: background 0.4s, color 0.3s;
    }
    .ringmode:before, .ringmode body:before {
      content:"";
      position:fixed; z-index:0; top:0; left:0; width:100vw; height:100vh;
      background-image: url('https://i.imgur.com/jU1VQPI.jpg'); /* Seamless parchment */
      background-size: cover;
      background-repeat: repeat;
      background-attachment: fixed;
      opacity: 0.44;
      pointer-events:none;
      filter: blur(0.7px) contrast(1.03) brightness(1.11);
    }
    .ringmode .container {
      background: rgba(43, 36, 10, 0.97) !important;
      color: var(--ring-txt) !important;
      box-shadow: 0 4px 32px #5c4b0a99;
      border: 1.5px solid #a3945e;
      /* Parchment feel overlay */
      background-image: url('https://i.imgur.com/jU1VQPI.jpg');
      background-size: cover;
      background-blend-mode: multiply;
      background-repeat: no-repeat;
      background-position: center top;
    }
    .ringmode .goal-line, .ringmode .meal-log-table th, .ringmode .macro-bar-label {
      background: #2e2208 !important;
      color: #fbe62c !important;
    }
    .ringmode .macro-bar-outer { background: #b49c24 !important; }
    .ringmode .bar-cal { background: linear-gradient(90deg,#fbe62c,#cfa211) !important; color: #5d4b04;}
    .ringmode .bar-p { background: linear-gradient(90deg,#7dc271,#3b7f2d);}
    .ringmode .bar-c { background: linear-gradient(90deg,#5ba4fa,#30426e);}
    .ringmode .bar-f { background: linear-gradient(90deg,#f5a94d,#ad7a1d);}
    .ringmode .macro-bar-label { color: #fff9db !important;}
    .ringmode .streak-bar-wrap { background: #3a3008 !important; color: #fbe62c !important;}
    .ringmode .export-btn { background: #3e3108; color: #fbe62c;}
    .ringmode .theme-btn { background: #fbe62c; color: #3b2e08;}
    .ringmode .theme-btn.active { background: #fff; color: #a28907;}
    .ringmode .meal-log-table th { color: #edb941;}
    .ringmode .meal-log-table { background: #382a00; }
    .ringmode .meal-log-table td { color: #fbe62c;}
    .ringmode .quote-row {
      background: linear-gradient(90deg,#bda06299 0%, #f8f1ca 100%);
      color: #aaaeb8 !important;
      border-top: 2.2px solid #a3945e;
      border-bottom: 2.2px solid #a3945e;
      font-size: 1.23em;
      font-family: 'Ringbearer', 'Inter', serif;
      text-shadow: 0 1px 6px #222a, 0 0px 1.5px #faf3e9;
    }
    /* Responsive! */
    @media (max-width: 680px) {
      .container {
        padding: 1.1em 3.7vw 1.8em 3.7vw;
        margin: 3vw 0 10vw 0;
        max-width: 99vw;
        border-radius: 0 0 22px 22px;
      }
      .theme-toggle {
        position: static;
        justify-content: center;
        margin-top: 0.7em;
        margin-bottom: 0.9em;
        width: 100%;
        gap: 16px;
      }
      h1 {
        padding-top: 0.3em;
        margin-bottom: 0.3em;
        font-size: 1.35rem;
      }
      .tab-row { margin-top: 0.3em; gap: 9px;}
      .quote-row { font-size: 1.02em; padding: 12px 4px 9px 4px;}
      .streak-ring-wrap { width: 39vw; height: 39vw; min-width:110px; min-height:110px; }
      .macro-input-row, .add-meal-row { gap: 0.7em;}
      .meal-log-table th, .meal-log-table td { padding: 6px 5px; }
      #macroChart { height: 120px; }
    }
    @media (max-width: 480px) {
      .container {
        padding: 0.4em 4vw 0.7em 4vw;
        margin: 2vw 0 7vw 0;
      }
      .macro-input-row, .add-meal-row { gap: 0.5em;}
    }
    .toast {
      position: fixed; left: 50%; bottom: 36px; transform: translateX(-50%);
      background: #fffbe0; color: #2b78e4;
      padding: 16px 31px; border-radius: 22px;
      box-shadow: 0 5px 22px #0006; font-size: 1.19em; font-weight: 700;
      opacity: 0.97; z-index: 999; pointer-events: none; animation: fadeToast 2.2s linear;
    }
    @keyframes fadeToast {
      0%{opacity:0;}
      10%{opacity:1;}
      85%{opacity:0.98;}
      100%{opacity:0;}
    }
  </style>
</head>
<body>
  <div class="container" id="macroLegendContainer">
    <h1>MacroLegend</h1>
    <div class="theme-toggle">
      <button class="theme-btn active" id="appleLightBtn" onclick="setTheme('light')">Apple Light</button>
      <button class="theme-btn" id="ringModeBtn" onclick="setTheme('ring')">Ring Mode</button>
    </div>
    <div class="tab-row">
      <button class="tab-btn active" id="tabCalc" onclick="showTab('calc')">Macro Calculator</button>
      <button class="tab-btn" id="tabProg" onclick="showTab('prog')">Macro Progression</button>
    </div>
    <div id="tabArea"></div>
    <div id="quoteRow" class="quote-row"></div>
    <audio id="streakSound" preload="auto">
      <source src="https://cdn.pixabay.com/audio/2022/07/26/audio_124b01f3be.mp3" type="audio/mp3">
    </audio>
    <video id="barcodeVideo" autoplay playsinline></video>
    <div id="barcodeOverlay"></div>
    <button id="barcodeCancelBtn" onclick="stopBarcodeScan()">Cancel Scan</button>
  </div>
  <!-- Chart.js and Quagga2 -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2@1.2.6/dist/quagga.min.js"></script>
  <!-- Your full JS goes here (unchanged from the last version except where you want tweaks for quoteRow, spacing, and new backgrounds). -->
  <!-- Paste your JS here. If you want me to update JS with more spacing/tweaks, let me know! -->
</body>
</html>
